<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-menu/paper-menu.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="shared-styles.html">
<script src='../bower_components/cytoscape/dist/cytoscape.min.js'></script>
<dom-module id="rt-graphs">
  <template>
  <style is='custom-style' include="shared-styles iron-flex-factors iron-flex-alignment iron-positioning ">
      :host {
        display: block;
        @apply(--layout-vertical);
        padding: 10px;
      }
      paper-menu{
        @apply(--layout-vertical);
        max-width: 200px;
      }
      paper-button,#display iron-label{
        @apply(--layout-flex)
      }
      #container,iron-label{
        @apply(--layout-horizontal)
      }
      iron-label,iron-label span{
        @apply(--layout-center)
        @apply(--layout-flex)
        /*max-width: 200px;*/
      }
      paper-menu > *{
        @apply(--layout-flex)
      }
      #display{
        @apply(--layout-vertical)
        overflow-y: scroll;
      }
      iron-label span{
        max-width: 200px;

      }
      iron-label{
        min-height:64px;
      }
      #cy{
        width: 100%;
        height: 750px;
        display: block;
        border-style: dashed;
        border-color: black;
      }
    </style>

    <h2>Graphs</h2>
    <div id='container' class='layout horizontal'>
      <paper-menu id='menu' selected='{{selectedGraph}}' attr-for-selected='name' selectable='paper-item' class='layout vertical'>
        <iron-label class='layout vertical'>Display Options
        </iron-label>
          <paper-item name='full'>Full Graph</paper-item>
          <paper-item name='relationship'>Relationship Focus Graph</paper-item>
          <paper-item name='badapple'>Bad Apple Graph</paper-item>
        <iron-label class='layout vertical'>Additional Options
        </iron-label>
          <paper-button>Print</paper-button>
          <paper-button>Save</paper-button>
        </paper-menu>
      <div id='display' class='layout vertical flex'>
        <iron-label class='flex'>
          <span class='flex layout horizontal'>
            Number of Nodes:
          </span>
          <paper-input label='Number of Nodes' value='[[inputs.numNodes]]' readonly class='flex'></paper-input>
        </iron-label>
        <iron-label class='flex'>
          <span class='flex'>
            List of Unique Nodes
          </span>
          <paper-input label='List of Unique Nodes' value='[[inputs.nodeList]]' readonly class='flex'></paper-input>
        </iron-label>
        <iron-label class='flex'>
          <span class='flex'>
            Relationship Focus Group
          </span>
          <paper-input label='Relationship Focus Group' value='[[inputs.focusGroup]]' readonly class='flex'></paper-input>
        </iron-label>
        <iron-label class='flex'>
          <span class='flex'>
            Bad Apple:
          </span>
          <paper-input label='Bad Apple' value='[[inputs.targetNode]]' readonly class='flex'></paper-input>
        </iron-label>
        <iron-label class='flex'>
          <span class='flex'>
            Grapht Type:
          </span>
          <paper-input label='Graph Type' value='[[inputs.graphType]]' readonly class='flex'></paper-input>
        </iron-label>

        <div id='cy'>

        </div>
      </div>

    </div>
  </template>

  <script>
    Polymer({
      is: 'rt-graphs',
      ready: function(){
        window.addEventListener('init-graphs',this.init.bind(this));

      },
      properties: {
        name: {notify: true, value: 'rt-graphs'},
        inputs: {notify: true},
        page: {notify: true, observer: '_page'},
        graphType: {notify: true, computed: '_graphType(inputs)'},
        selectedGraph: {notify: true},
        cy: {notify: true},
      },

      _graphType: function(inputs){
        this.selectedGraph = inputs.graphType;
        return inputs.graphType;
      },
      init: function(e){
        console.log('init graphs');
      },
      _makeGraph: function(){

      },
      _page: function(page){
        if(page =='rt-graphs'){
          console.log('can i start the map?',this.inputs);
        }
        console.log(JSON.stringify(this.inputs.graphData, null, 2));
        //add styles for all graphs
        this.cy = cytoscape({
          container: this.$.cy,
          elements: {
            nodes:this.inputs.graphData.nodes,
            edges: this.inputs.graphData.edges
          },
          style: cytoscape.stylesheet()
          .selector('node')
          .css({
            'background-color': 'black',
            'width': 'mapData(baz, 0, 10, 10, 40)',
            'height': 'mapData(baz, 0, 10, 10, 40)',
            'content': 'data(id)'
          })
          .selector('edge')
          .css({
            'curve-style': 'bezier',
            'line-color': 'black',
            'mid-target-arrow-color': 'black',
            'width': 2,
            'mid-target-arrow-shape': 'triangle',
            'opacity': 0.8
          })
          .selector(':selected')
          .css({
            'background-color': 'blue',
            'line-color': 'blue',
            'target-arrow-color': 'blue',
            'source-arrow-color': 'blue',
            'opacity': 1
          })
          .selector('node.target')
          .css({
            'text-background-color': 'black',
            'background-color': '#B3767E',
            'line-color': '#B3767E',
            'color': '#B3767E',
            'target-arrow-color': '#B3767E',
            'source-arrow-color': '#B3767E',
            'opacity': 1
          })
          .selector('node.focus')
          .css({
            'text-background-color': 'black',
            'background-color': '#7692b3',
            'line-color': '#7692b3',
            'color': '#7692b3',
            'target-arrow-color': '#7692b3',
            'source-arrow-color': '#7692b3',
            'opacity': 1
          })
          .selector('edge.target')
          .css({
            'curve-style': 'bezier',
            'line-color': '#F2B1BA',
            'mid-target-arrow-color': '#F2B1BA',
            'width': 2,
            'mid-target-arrow-shape': 'triangle',
            'opacity': 0.8
          })
          .selector('edge.focus')
          .css({
            'curve-style': 'bezier',
            'line-color': '#b1bdf2',
            'mid-target-arrow-color': '#b1bdf2',
            'width': 2,
            'mid-target-arrow-shape': 'triangle',
            'opacity': 0.8
          })
          .selector('.faded')
          .css({
            'opacity': 0.25,
            'text-opacity': 0
          }),
          layout: {
            name: 'circle',
            padding: 10,
            avoidOverlap: true,
            fit: true,
            radius:this.inputs.numNodes * 20,
            avoidOverlapPadding: 10,
          },
          directed: true,
          styleEnabled: true
        });
        if(this.inputs.graphType == 'full'){
          //  add nodes and edges
          console.log('full')
        }
        if(this.inputs.graphType == 'badapple'){
          console.log('badapple')
          var targetNode = this.cy.elements('#'+this.inputs.targetNode);
          targetNode.addClass('target');
          this.inputs.graphData.targetEdges.forEach(function(edge){
            console.log(edge)
            this.cy.elements('#'+ edge.data.id).addClass('target');
          },this);
        }
        if(this.inputs.graphType == 'relationship'){
          console.log('relationship')
          this.inputs.focusGroup.split(',').forEach(function(id){
            this.cy.elements('#'+id).addClass('focus');
          },this);
          this.inputs.graphData.edges.forEach(function(el){
            if(this.inputs.focusGroup.indexOf(el.data.source) != -1 || this.inputs.focusGroup.indexOf(el.data.target) != -1 ){
              console.log(el.data.id)
              this.cy.elements('#'+el.data.id).addClass('focus');
            }
          },this);
        }

      }
    });
  </script>
</dom-module>
